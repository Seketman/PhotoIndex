window.app=angular.module("resourceManagerApp",["ui.select2","ngTable","ngRoute","ngResource","ngAnimate","custom-utilities"]),app.config(["$routeProvider","$locationProvider","$httpProvider","$provide",function(e,t,r,o){r.defaults.useXDomain=!0,delete r.defaults.headers.common["X-Requested-With"],r.defaults.useXDomain=!0,t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/shared/Login.html"}).when("/Register",{templateUrl:"/Scripts/app/views/shared/Register.html"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Photos",{templateUrl:"/Scripts/app/views/photos/Photos-ng-table.html",controller:"PhotosCtrl"}).when("/Photos/:photoId",{templateUrl:"/Scripts/app/views/photos/Details.html",controller:"PhotosCtrl"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources-ng-table.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),r.interceptors.push("authorizationInterceptor"),r.interceptors.push("httpInterceptor")}]).factory("userProfileSvc",function(){return{}}),window.utilities=angular.module("custom-utilities",[]);
window.app=angular.module("resourceManagerApp",["ui.select2","ngTable","ngRoute","ngResource","ngAnimate","custom-utilities"]),app.config(["$routeProvider","$locationProvider","$httpProvider","$provide",function(e,t,o,r){o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],o.defaults.useXDomain=!0,t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/shared/Login.html"}).when("/Register",{templateUrl:"/Scripts/app/views/shared/Register.html"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Photos",{templateUrl:"/Scripts/app/views/photos/Photos-ng-table.html",controller:"PhotosCtrl"}).when("/Photos/:photoId",{templateUrl:"/Scripts/app/views/photos/Details.html",controller:"PhotosCtrl"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources-ng-table.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),o.interceptors.push("authorizationInterceptor"),o.interceptors.push("httpInterceptor")}]).factory("userProfileSvc",function(){return{}}),window.utilities=angular.module("custom-utilities",[]),window.app=angular.module("resourceManagerApp",["ui.select2","ngTable","ngRoute","ngResource","ngAnimate","custom-utilities"]),app.config(["$routeProvider","$locationProvider","$httpProvider","$provide",function(e,t,o,r){o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],o.defaults.useXDomain=!0,t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/shared/Login.html"}).when("/Register",{templateUrl:"/Scripts/app/views/shared/Register.html"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Photos",{templateUrl:"/Scripts/app/views/photos/Photos-ng-table.html",controller:"PhotosCtrl"}).when("/Photos/:photoId",{templateUrl:"/Scripts/app/views/photos/Details.html",controller:"PhotosCtrl"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources-ng-table.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),o.interceptors.push("authorizationInterceptor"),o.interceptors.push("httpInterceptor")}]).factory("userProfileSvc",function(){return{}}),window.utilities=angular.module("custom-utilities",[]),window.app=angular.module("resourceManagerApp",["ui.select2","ngTable","ngRoute","ngResource","ngAnimate","custom-utilities"]),app.config(["$routeProvider","$locationProvider","$httpProvider","$provide",function(e,t,o,r){o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],o.defaults.useXDomain=!0,t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/shared/Login.html"}).when("/Register",{templateUrl:"/Scripts/app/views/shared/Register.html"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Photos",{templateUrl:"/Scripts/app/views/photos/Photos-ng-table.html",controller:"PhotosCtrl"}).when("/Photos/:photoId",{templateUrl:"/Scripts/app/views/photos/Details.html",controller:"PhotosCtrl"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources-ng-table.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),o.interceptors.push("authorizationInterceptor"),o.interceptors.push("httpInterceptor")}]).factory("userProfileSvc",function(){return{}}),window.utilities=angular.module("custom-utilities",[]),window.app=angular.module("resourceManagerApp",["ui.select2","ngTable","ngRoute","ngResource","ngAnimate","custom-utilities"]),app.config(["$routeProvider","$locationProvider","$httpProvider","$provide",function(e,t,o,r){o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],o.defaults.useXDomain=!0,t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/shared/Login.html"}).when("/Register",{templateUrl:"/Scripts/app/views/shared/Register.html"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources-ng-table.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),o.interceptors.push("authorizationInterceptor"),o.interceptors.push("httpInterceptor")}]).factory("userProfileSvc",function(){return{}}),window.utilities=angular.module("custom-utilities",[]),app.factory("authorizationInterceptor",["$rootScope","$q","$location",function(e,t,o){return{responseError:function(r){switch(r.status){case 401:e.$broadcast("logOff"),o.url("/Login");break;case 403:o.url("/Login")}return t.reject(r)}}}]),app.controller("ActivitiesCtrl",["$scope","$location","activitySvc",function(e,t,o){e.deleteActivity=function(t){o.deleteActivity(t).then(function(r){e.activities=o.getActivites(t.ResourceId)})}}]),app.controller("ActivityAddCtrl",["$scope","$location","$routeParams","activitySvc",function(e,t,o,r){e.activity={ResourceId:o.resourceId},e.addActivity=function(e,o){r.addActivity(e).then(function(e){t.url("/Resources/"+e.ResourceId)})}}]),app.controller("HomeCtrl",["$scope","resourceSvc",function(e,t){function o(){r()}function r(){e.resources=t.getTopFiveResources()}o()}]),app.controller("LocationCtrl",["$scope","$location","$routeParams","locationSvc",function(e,t,o,r){function n(){o.locationId>0&&(e.location=r.getLocation(o.locationId))}e.addLocation=function(e){r.addLocation(e).$promise.then(function(e){t.url("/Locations")})},e.editLocation=function(e){r.editLocation(e).$promise.then(function(e){t.url("/Locations")})},n()}]),app.controller("LocationsCtrl",["$scope","ngTableParams","locationSvc",function(e,t,o){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e,t){o.getLocations().$promise.then(function(t){e.resolve(t)})}}),e.deleteLocation=function(t){o.deleteLocation(t).$promise.then(function(t,o){e.tableParams.reload()})}}]),app.controller("ResourceCtrl",["$scope","$routeParams","$location","resourceSvc","locationSvc",function(e,t,o,r,n){function i(){t.resourceId>0?e.resource=r.getResource(t.resourceId):e.locations=n.getLocations()}e.resource={hasActivites:!1},e.addResource=function(e){r.addResource(e).$promise.then(function(e){o.url("/Resources")})},i()}]),app.controller("ResourceEditCtrl",["$scope","$location","$routeParams","resourceSvc",function(e,t,o,r){function n(){for(var e=[],t=1;10>=t;t++)e.push({priority:t});return e}function i(){r.createResourceEditFormModel(o.resourceId).then(function(t){e.resource=t[0],e.locations=t[1],e.priorities=n()})}i(),e.editResource=function(e){r.editResource(e).$promise.then(function(e){t.url("/Resources")})}}]),app.controller("ResourcesCtrl",["$scope","resourceSvc","ngTableParams",function(e,t,o){var r=function(e){var t,o,r=e.sorting();if(r)for(var n in r){t=n,o=r[n];break}return{page:e.page(),count:e.count(),sortField:t,sortOrder:o}};e.tableParams=new o({page:1,count:10,sorting:{Name:"asc"}},{counts:[],total:0,getData:function(e,o){t.getPagedResources(r(o)).$promise.then(function(t){o.total(t.TotalCount),e.resolve(t.Data)})["catch"](function(e){console.log(e)})}}),e.deleteResource=function(o){t.deleteResource(o).$promise.then(function(t){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]),app.controller("ResourceMngrCtrl",["$scope","$location","resourceMngrSvc",function(e,t,o){e.login=function(r){e.errorMessage="",o.login(r).$promise.then(function(o){e.$emit("logOn"),t.url("/Home")})["catch"](function(t){404==t.status&&(e.errorMessage=t.data),400===t.status?e.errorMessage="Invalid Email/Password":e.errorMessage="An error occured while performing this action. Please try after some time."})},e.register=function(r){return r.password!==r.confirmPassword?void(e.errorMessage="Passwords do not match"):(e.errorMessage="",void o.registerUser(r).$promise.then(function(n){return o.login({Email:r.email,Password:r.password}).$promise.then(function(o){e.$emit("logOn"),t.url("/Home")})})["catch"](function(t){400===t.status?e.errorMessage="Email already exists.":e.errorMessage="An error occured while performing this action. Please try after some time."}))},e.logOff=function(){o.logOffUser(),e.$emit("logOff"),t.url("/Login")}}]),app.directive("resourceActivityList",function(){return{restrict:"E",templateUrl:"/Scripts/app/directives/activities/ResourceActivityList.html",scope:{activities:"=activities"}}}),utilities.directive("cstConfirmModal",[function(){return{restrict:"A",scope:{approve:"&onApprove",deny:"&onDeny",closable:"=closable",id:"@modalId",title:"@title",message:"@message"},templateUrl:"/Scripts/app/partials/confirm-modal.html",link:function(e,t,o,r){e.closeModal=function(){angular.element("#"+e.id).modal("hide")},t.on("click",function(t){angular.element("#"+e.id).modal("show")})}}}]),utilities.directive("cstDatepicker",function(){return{restrict:"A",require:"ngModel",replace:!0,link:function(e,t,o,r){t.datepicker({maxDate:0,onSelect:function(t){r.$setViewValue(t),e.$apply(),r.$setValidity("invalid",!1)}}),t.on("keypress",function(e){return!1})}}}),utilities.directive("cstExternalUrl",function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return{link:function(o,r,n){var i=n.cstExternalUrl;i&&t.test(i)&&(o.isWebUrl=!0,r.css("text-decoration","underline"),r.css("cursor","pointer")),r.on("click",function(){o.isWebUrl&&e.open(i)})}}}),app.directive("cstDelete",function(){return{replace:!0,link:function(e,t,o,r){console.log(t),t.on("click",function(e){return confirm("Delete item?")})}}}),utilities.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor","templateSvc",function(e,t,o,r){function n(e){e.removeClass("hide"),e.addClass("show")}function i(e){e.removeClass("show"),e.addClass("hide")}var c=/\.html$|\.html\?/i,s={};return{restrict:"E",templateUrl:"/Scripts/app/partials/Loader.html",link:function(a,u,l){var p=[];o.request=function(e){return console.log("request: "+e.url),p.push({}),1==p.length&&n(u),e||t.when(e)},o.response=function(o){return c.test(o.config.url)&&(s[o.config.url]||(o.data=r.processTemplate(o),s[o.config.url]=!0)),console.log("response: "+o.config.url),p.pop(),0===p.length&&e(function(){0===p.length&&i(u)},500),o||t.when(o)},o.responseError=function(o){return p.pop(),0===p.length&&e(function(){0===p.length&&i(u)},500),t.reject(o)}}}}]),utilities.factory("httpInterceptor",function(){return{}}),utilities.service("templateSvc",["$templateCache","userProfileSvc",function(e,t){var o=/data-(keep|omit)/;return{processTemplate:function(r){var n=r.data,i=$("<div>").append(n);return o.test(n)&&i.find('[data-omit="'+t.role+'"]').each(function(){var e=$(this);e.remove()}),n=i.html(),e.put(r.config.url,n),n}}}]),utilities.directive("cstModal",function(){return{required:"ngModel",restrict:"A",link:function(e,t,o,r){t.on("click",function(e){var t="#"+o.cstModal;$(t).modal("show")})}}}),app.directive("cstTopMenu",function(){return{restrict:"E",replace:!0,templateUrl:"/Scripts/app/partials/TopMenu.html",link:function(e,t,o){var r=t.find("a");r.on("click",function(){r.removeClass("active"),$(this).addClass("active")}),e.$on("logOff",function(){e.isAuthenticated=!1}),e.$on("logOn",function(){e.isAuthenticated=!0})}}}),app.service("activitySvc",["$resource","serviceHelperSvc",function(e,t){var o=t.ResourceActivity,r=function(e){return o.save({resourceId:e.ResourceId},e).$promise},n=function(e){return o["delete"]({resourceId:e.ResourceId,activityId:e.Id}).$promise},i=function(e){return o.query({resourceId:e})};return{addActivity:r,deleteActivity:n,getActivites:i}}]),app.factory("locationSvc",["$resource","serviceHelperSvc",function(e,t){var o=t.Location,r=function(e){return o.save(e)},n=function(e){var t=o.update(e);return t},i=function(e){return o.get({locationId:e})},c=function(){return o.query()},s=function(e){return o["delete"]({locationId:e})};return{addLocation:r,editLocation:n,getLocation:i,getLocations:c,deleteLocation:s}}]),app.factory("resourceSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,t,o,r){var n=r.Resource,i=function(){return n.query({count:5})},c=function(){return n.query()},s=function(e){return n["delete"]({resourceId:e})},a=function(e){return n.save(e)},u=function(e){return n.update(e)},l=function(e){return n.get({resourceId:e})},p=function(e){var r=t.all([this.getResource(e).$promise,o.getLocations().$promise]);return r},d=function(e){return n.getPagedItems(e)};return{getTopFiveResources:i,getResources:c,deleteResource:s,addResource:a,editResource:u,getResource:l,createResourceEditFormModel:p,getPagedResources:d}}]),app.factory("resourceMngrSvc",["$http","serviceHelperSvc","userProfileSvc",function(e,t,o){var r=t.AuthorizationToken,n=t.Account,i=function(e){var t="";for(var o in e)e.hasOwnProperty(o)&&(t+=o+"="+e[o]+"&");return t.slice(0,t.length-1)};return{login:function(t){var n={username:t.Email,password:t.Password,grant_type:"password"};return r.requestToken(i(n),function(t){e.defaults.headers.common.Authorization="Bearer "+t.access_token,o.role=t.role})},registerUser:function(e){var t=n.register(e);return t},logOffUser:function(){e.defaults.headers.common.Authorization=null}}}]),app.factory("serviceHelperSvc",["$http","$resource",function(e,t){var o=config.apiurl,r=function(e){return o+e};return{AuthorizationToken:t(r("Token"),null,{requestToken:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),Account:t(r("api/Account/"),null,{register:{method:"post"},logOff:{method:"put"}}),Resource:t(r("api/Resources/:resourceId"),{resourceId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:r("api/Resources?count=:count&page=:page&sortField=:sortField&sortOrder=:sortOrder"),method:"GET",params:{count:"@count",page:"@page",sortField:"@sortField",sortOrder:"@sortOrder"}}}),Location:t(r("api/Locations/:locationId"),{locationId:"@Id"},{update:{method:"PUT"}}),ResourceActivity:t(r("api/Resources/:resourceId/Activities/:activityId"),{resourceId:"@ResourceId",activityId:"@Id"})}}]),app.factory("authorizationInterceptor",["$rootScope","$q","$location",function(e,t,o){return{responseError:function(r){switch(r.status){case 401:e.$broadcast("logOff"),o.url("/Login");break;case 403:o.url("/Login")}return t.reject(r)}}}]),app.controller("ActivitiesCtrl",["$scope","$location","activitySvc",function(e,t,o){e.deleteActivity=function(t){o.deleteActivity(t).then(function(r){e.activities=o.getActivites(t.ResourceId)})}}]),app.controller("ActivityAddCtrl",["$scope","$location","$routeParams","activitySvc",function(e,t,o,r){e.activity={ResourceId:o.resourceId},e.addActivity=function(e,o){r.addActivity(e).then(function(e){t.url("/Resources/"+e.ResourceId)})}}]),app.controller("HomeCtrl",["$scope","resourceSvc",function(e,t){function o(){r()}function r(){e.resources=t.getTopFiveResources()}o()}]),app.controller("LocationCtrl",["$scope","$location","$routeParams","locationSvc",function(e,t,o,r){function n(){o.locationId>0&&(e.location=r.getLocation(o.locationId))}e.addLocation=function(e){r.addLocation(e).$promise.then(function(e){t.url("/Locations")})},e.editLocation=function(e){r.editLocation(e).$promise.then(function(e){t.url("/Locations")})},n()}]),app.controller("LocationsCtrl",["$scope","ngTableParams","locationSvc",function(e,t,o){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e,t){o.getLocations().$promise.then(function(t){e.resolve(t)})}}),e.deleteLocation=function(t){o.deleteLocation(t).$promise.then(function(t,o){e.tableParams.reload()})}}]),app.controller("PhotoCtrl",["$scope","$routeParams","$location","photoSvc",function(e,t,o,r){function n(){t.photoId>0?e.photo=r.getPhoto(t.photoId):e.locations=locationSvc.getLocations()}e.photo={},e.addPhoto=function(e){r.addPhoto(e).$promise.then(function(e){o.url("/Photos")})},n()}]),app.controller("PhotosCtrl",["$scope","photosSvc","ngTableParams",function(e,t,o){var r=function(e){var t,o,r=e.sorting();if(r)for(var n in r){t=n,o=r[n];break}return{page:e.page(),count:e.count()}};e.tableParams=new o({page:1,count:10},{counts:[],total:0,getData:function(e,o){t.getPagedPhoto(r(o)).$promise.then(function(t){o.total(t.TotalCount),e.resolve(t.Data)})["catch"](function(e){console.log(e)})}}),e.deletePhoto=function(o){t.deletePhoto(o).$promise.then(function(t){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]),app.controller("ResourceCtrl",["$scope","$routeParams","$location","resourceSvc","locationSvc",function(e,t,o,r,n){function i(){t.resourceId>0?e.resource=r.getResource(t.resourceId):e.locations=n.getLocations()}e.resource={hasActivites:!1},e.addResource=function(e){r.addResource(e).$promise.then(function(e){o.url("/Resources")})},i()}]),app.controller("ResourceEditCtrl",["$scope","$location","$routeParams","resourceSvc",function(e,t,o,r){function n(){for(var e=[],t=1;10>=t;t++)e.push({priority:t});return e}function i(){r.createResourceEditFormModel(o.resourceId).then(function(t){e.resource=t[0],e.locations=t[1],e.priorities=n()})}i(),e.editResource=function(e){r.editResource(e).$promise.then(function(e){t.url("/Resources")})}}]),app.controller("ResourcesCtrl",["$scope","resourceSvc","ngTableParams",function(e,t,o){var r=function(e){var t,o,r=e.sorting();if(r)for(var n in r){t=n,o=r[n];break}return{page:e.page(),count:e.count(),sortField:t,sortOrder:o}};e.tableParams=new o({page:1,count:10,sorting:{Name:"asc"}},{counts:[],total:0,getData:function(e,o){t.getPagedResources(r(o)).$promise.then(function(t){o.total(t.TotalCount),e.resolve(t.Data)})["catch"](function(e){console.log(e)})}}),e.deleteResource=function(o){t.deleteResource(o).$promise.then(function(t){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]),app.controller("ResourceMngrCtrl",["$scope","$location","resourceMngrSvc",function(e,t,o){e.login=function(r){e.errorMessage="",o.login(r).$promise.then(function(o){e.$emit("logOn"),t.url("/Home")})["catch"](function(t){404==t.status&&(e.errorMessage=t.data),400===t.status?e.errorMessage="Invalid Email/Password":e.errorMessage="An error occured while performing this action. Please try after some time."})},e.register=function(r){return r.password!==r.confirmPassword?void(e.errorMessage="Passwords do not match"):(e.errorMessage="",void o.registerUser(r).$promise.then(function(n){return o.login({Email:r.email,Password:r.password}).$promise.then(function(o){e.$emit("logOn"),t.url("/Home")})})["catch"](function(t){400===t.status?e.errorMessage="Email already exists.":e.errorMessage="An error occured while performing this action. Please try after some time."}))},e.logOff=function(){o.logOffUser(),e.$emit("logOff"),t.url("/Login")}}]),app.directive("resourceActivityList",function(){return{restrict:"E",templateUrl:"/Scripts/app/directives/activities/ResourceActivityList.html",scope:{activities:"=activities"}}}),utilities.directive("cstConfirmModal",[function(){return{restrict:"A",scope:{approve:"&onApprove",deny:"&onDeny",closable:"=closable",id:"@modalId",title:"@title",message:"@message"},templateUrl:"/Scripts/app/partials/confirm-modal.html",link:function(e,t,o,r){e.closeModal=function(){angular.element("#"+e.id).modal("hide")},t.on("click",function(t){angular.element("#"+e.id).modal("show")})}}}]),utilities.directive("cstDatepicker",function(){return{restrict:"A",require:"ngModel",replace:!0,link:function(e,t,o,r){t.datepicker({maxDate:0,onSelect:function(t){r.$setViewValue(t),e.$apply(),r.$setValidity("invalid",!1)}}),t.on("keypress",function(e){return!1})}}}),utilities.directive("cstExternalUrl",function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return{link:function(o,r,n){var i=n.cstExternalUrl;i&&t.test(i)&&(o.isWebUrl=!0,r.css("text-decoration","underline"),r.css("cursor","pointer")),r.on("click",function(){o.isWebUrl&&e.open(i)})}}}),app.directive("cstDelete",function(){return{replace:!0,link:function(e,t,o,r){console.log(t),t.on("click",function(e){return confirm("Delete item?")})}}}),utilities.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor","templateSvc",function(e,t,o,r){function n(e){e.removeClass("hide"),e.addClass("show")}function i(e){e.removeClass("show"),e.addClass("hide")}var c=/\.html$|\.html\?/i,s={};return{restrict:"E",templateUrl:"/Scripts/app/partials/Loader.html",link:function(a,u,l){var p=[];o.request=function(e){return console.log("request: "+e.url),p.push({}),1==p.length&&n(u),e||t.when(e)},o.response=function(o){return c.test(o.config.url)&&(s[o.config.url]||(o.data=r.processTemplate(o),s[o.config.url]=!0)),console.log("response: "+o.config.url),p.pop(),0===p.length&&e(function(){0===p.length&&i(u)},500),o||t.when(o)},o.responseError=function(o){return p.pop(),0===p.length&&e(function(){0===p.length&&i(u)},500),t.reject(o)}}}}]),utilities.factory("httpInterceptor",function(){return{}}),utilities.service("templateSvc",["$templateCache","userProfileSvc",function(e,t){var o=/data-(keep|omit)/;return{processTemplate:function(r){var n=r.data,i=$("<div>").append(n);return o.test(n)&&i.find('[data-omit="'+t.role+'"]').each(function(){var e=$(this);e.remove()}),n=i.html(),e.put(r.config.url,n),n}}}]),utilities.directive("cstModal",function(){return{required:"ngModel",restrict:"A",link:function(e,t,o,r){t.on("click",function(e){var t="#"+o.cstModal;$(t).modal("show")})}}}),app.directive("cstTopMenu",function(){return{restrict:"E",replace:!0,templateUrl:"/Scripts/app/partials/TopMenu.html",link:function(e,t,o){var r=t.find("a");r.on("click",function(){r.removeClass("active"),$(this).addClass("active")}),e.$on("logOff",function(){e.isAuthenticated=!1}),e.$on("logOn",function(){e.isAuthenticated=!0})}}}),app.service("activitySvc",["$resource","serviceHelperSvc",function(e,t){var o=t.ResourceActivity,r=function(e){return o.save({resourceId:e.ResourceId},e).$promise},n=function(e){return o["delete"]({resourceId:e.ResourceId,activityId:e.Id}).$promise},i=function(e){return o.query({resourceId:e})};return{addActivity:r,deleteActivity:n,getActivites:i}}]),app.factory("locationSvc",["$resource","serviceHelperSvc",function(e,t){var o=t.Location,r=function(e){return o.save(e)},n=function(e){var t=o.update(e);return t},i=function(e){return o.get({locationId:e})},c=function(){return o.query()},s=function(e){return o["delete"]({locationId:e})};return{addLocation:r,editLocation:n,getLocation:i,getLocations:c,deleteLocation:s}}]),app.factory("photoSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,t,o,r){var n=r.Photo,i=function(){return n.query({count:5})},c=function(){return n.query()},s=function(e){return n["delete"]({resourceId:e})},a=function(e){return n.save(e)},u=function(e){return n.update(e)},l=function(e){return n.get({photoId:e})},p=function(e){var r=t.all([this.getPhoto(e).$promise,o.getLocations().$promise]);return r};return{getTopPhotos:i,getPhotos:c,deletePhoto:s,addPhoto:a,editPhoto:u,getPhoto:l,createPhotoEditFormModel:p,getPagedPhoto:getPagedPhoto}}]),app.factory("resourceSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,t,o,r){var n=r.Resource,i=function(){return n.query({count:5})},c=function(){return n.query()},s=function(e){return n["delete"]({resourceId:e})},a=function(e){return n.save(e)},u=function(e){return n.update(e)},l=function(e){return n.get({resourceId:e})},p=function(e){var r=t.all([this.getResource(e).$promise,o.getLocations().$promise]);return r},d=function(e){return n.getPagedItems(e)};return{getTopFiveResources:i,getResources:c,deleteResource:s,addResource:a,editResource:u,getResource:l,createResourceEditFormModel:p,getPagedResources:d}}]),app.factory("resourceMngrSvc",["$http","serviceHelperSvc","userProfileSvc",function(e,t,o){var r=t.AuthorizationToken,n=t.Account,i=function(e){var t="";for(var o in e)e.hasOwnProperty(o)&&(t+=o+"="+e[o]+"&");return t.slice(0,t.length-1)};return{login:function(t){var n={username:t.Email,password:t.Password,grant_type:"password"};return r.requestToken(i(n),function(t){e.defaults.headers.common.Authorization="Bearer "+t.access_token,o.role=t.role})},registerUser:function(e){var t=n.register(e);return t},logOffUser:function(){e.defaults.headers.common.Authorization=null}}}]),app.factory("serviceHelperSvc",["$http","$resource",function(e,t){var o=config.apiurl,r=function(e){return o+e};return{AuthorizationToken:t(r("Token"),null,{requestToken:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),Account:t(r("api/Account/"),null,{register:{method:"post"},logOff:{method:"put"}}),Photo:t(r("api/Photos/:photoId"),{photoId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:r("api/Photos?count=:count&page=:page"),method:"GET",params:{count:"@count",page:"@page"}}}),Resource:t(r("api/Resources/:resourceId"),{resourceId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:r("api/Resources?count=:count&page=:page&sortField=:sortField&sortOrder=:sortOrder"),method:"GET",params:{count:"@count",page:"@page",sortField:"@sortField",sortOrder:"@sortOrder"}}}),Location:t(r("api/Locations/:locationId"),{locationId:"@Id"},{update:{method:"PUT"}}),ResourceActivity:t(r("api/Resources/:resourceId/Activities/:activityId"),{resourceId:"@ResourceId",activityId:"@Id"})}}]),app.factory("authorizationInterceptor",["$rootScope","$q","$location",function(e,t,o){return{responseError:function(r){switch(r.status){case 401:e.$broadcast("logOff"),o.url("/Login");break;case 403:o.url("/Login")}return t.reject(r)}}}]),app.controller("ActivitiesCtrl",["$scope","$location","activitySvc",function(e,t,o){e.deleteActivity=function(t){o.deleteActivity(t).then(function(r){e.activities=o.getActivites(t.ResourceId)})}}]),app.controller("ActivityAddCtrl",["$scope","$location","$routeParams","activitySvc",function(e,t,o,r){e.activity={ResourceId:o.resourceId},e.addActivity=function(e,o){r.addActivity(e).then(function(e){t.url("/Resources/"+e.ResourceId)})}}]),app.controller("HomeCtrl",["$scope","resourceSvc",function(e,t){function o(){r()}function r(){e.resources=t.getTopFiveResources()}o()}]),app.controller("LocationCtrl",["$scope","$location","$routeParams","locationSvc",function(e,t,o,r){function n(){o.locationId>0&&(e.location=r.getLocation(o.locationId))}e.addLocation=function(e){r.addLocation(e).$promise.then(function(e){t.url("/Locations")})},e.editLocation=function(e){r.editLocation(e).$promise.then(function(e){t.url("/Locations")})},n()}]),app.controller("LocationsCtrl",["$scope","ngTableParams","locationSvc",function(e,t,o){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e,t){o.getLocations().$promise.then(function(t){e.resolve(t)})}}),e.deleteLocation=function(t){o.deleteLocation(t).$promise.then(function(t,o){e.tableParams.reload()})}}]),app.controller("PhotoCtrl",["$scope","$routeParams","$location","photoSvc",function(e,t,o,r){function n(){t.photoId>0?e.photo=r.getPhoto(t.photoId):e.locations=locationSvc.getLocations()}e.photo={},e.addPhoto=function(e){r.addPhoto(e).$promise.then(function(e){o.url("/Photos")})},n()}]),app.controller("PhotosCtrl",["$scope","photosSvc","ngTableParams",function(e,t,o){var r=function(e){var t,o,r=e.sorting();if(r)for(var n in r){t=n,o=r[n];break}return{page:e.page(),count:e.count()}};e.tableParams=new o({page:1,count:10},{counts:[],total:0,getData:function(e,o){t.getPagedPhoto(r(o)).$promise.then(function(t){o.total(t.TotalCount),e.resolve(t.Data)})["catch"](function(e){console.log(e)})}}),e.deletePhoto=function(o){t.deletePhoto(o).$promise.then(function(t){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]),app.controller("ResourceCtrl",["$scope","$routeParams","$location","resourceSvc","locationSvc",function(e,t,o,r,n){function i(){t.resourceId>0?e.resource=r.getResource(t.resourceId):e.locations=n.getLocations()}e.resource={hasActivites:!1},e.addResource=function(e){r.addResource(e).$promise.then(function(e){o.url("/Resources")})},i()}]),app.controller("ResourceEditCtrl",["$scope","$location","$routeParams","resourceSvc",function(e,t,o,r){function n(){for(var e=[],t=1;10>=t;t++)e.push({priority:t});return e}function i(){r.createResourceEditFormModel(o.resourceId).then(function(t){e.resource=t[0],e.locations=t[1],e.priorities=n()})}i(),e.editResource=function(e){r.editResource(e).$promise.then(function(e){t.url("/Resources")})}}]),app.controller("ResourcesCtrl",["$scope","resourceSvc","ngTableParams",function(e,t,o){var r=function(e){var t,o,r=e.sorting();if(r)for(var n in r){t=n,
o=r[n];break}return{page:e.page(),count:e.count(),sortField:t,sortOrder:o}};e.tableParams=new o({page:1,count:10,sorting:{Name:"asc"}},{counts:[],total:0,getData:function(e,o){t.getPagedResources(r(o)).$promise.then(function(t){o.total(t.TotalCount),e.resolve(t.Data)})["catch"](function(e){console.log(e)})}}),e.deleteResource=function(o){t.deleteResource(o).$promise.then(function(t){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]),app.controller("ResourceMngrCtrl",["$scope","$location","resourceMngrSvc",function(e,t,o){e.login=function(r){e.errorMessage="",o.login(r).$promise.then(function(o){e.$emit("logOn"),t.url("/Home")})["catch"](function(t){404==t.status&&(e.errorMessage=t.data),400===t.status?e.errorMessage="Invalid Email/Password":e.errorMessage="An error occured while performing this action. Please try after some time."})},e.register=function(r){return r.password!==r.confirmPassword?void(e.errorMessage="Passwords do not match"):(e.errorMessage="",void o.registerUser(r).$promise.then(function(n){return o.login({Email:r.email,Password:r.password}).$promise.then(function(o){e.$emit("logOn"),t.url("/Home")})})["catch"](function(t){400===t.status?e.errorMessage="Email already exists.":e.errorMessage="An error occured while performing this action. Please try after some time."}))},e.logOff=function(){o.logOffUser(),e.$emit("logOff"),t.url("/Login")}}]),app.directive("resourceActivityList",function(){return{restrict:"E",templateUrl:"/Scripts/app/directives/activities/ResourceActivityList.html",scope:{activities:"=activities"}}}),utilities.directive("cstConfirmModal",[function(){return{restrict:"A",scope:{approve:"&onApprove",deny:"&onDeny",closable:"=closable",id:"@modalId",title:"@title",message:"@message"},templateUrl:"/Scripts/app/partials/confirm-modal.html",link:function(e,t,o,r){e.closeModal=function(){angular.element("#"+e.id).modal("hide")},t.on("click",function(t){angular.element("#"+e.id).modal("show")})}}}]),utilities.directive("cstDatepicker",function(){return{restrict:"A",require:"ngModel",replace:!0,link:function(e,t,o,r){t.datepicker({maxDate:0,onSelect:function(t){r.$setViewValue(t),e.$apply(),r.$setValidity("invalid",!1)}}),t.on("keypress",function(e){return!1})}}}),utilities.directive("cstExternalUrl",function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return{link:function(o,r,n){var i=n.cstExternalUrl;i&&t.test(i)&&(o.isWebUrl=!0,r.css("text-decoration","underline"),r.css("cursor","pointer")),r.on("click",function(){o.isWebUrl&&e.open(i)})}}}),app.directive("cstDelete",function(){return{replace:!0,link:function(e,t,o,r){console.log(t),t.on("click",function(e){return confirm("Delete item?")})}}}),utilities.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor","templateSvc",function(e,t,o,r){function n(e){e.removeClass("hide"),e.addClass("show")}function i(e){e.removeClass("show"),e.addClass("hide")}var c=/\.html$|\.html\?/i,s={};return{restrict:"E",templateUrl:"/Scripts/app/partials/Loader.html",link:function(a,u,l){var p=[];o.request=function(e){return console.log("request: "+e.url),p.push({}),1==p.length&&n(u),e||t.when(e)},o.response=function(o){return c.test(o.config.url)&&(s[o.config.url]||(o.data=r.processTemplate(o),s[o.config.url]=!0)),console.log("response: "+o.config.url),p.pop(),0===p.length&&e(function(){0===p.length&&i(u)},500),o||t.when(o)},o.responseError=function(o){return p.pop(),0===p.length&&e(function(){0===p.length&&i(u)},500),t.reject(o)}}}}]),utilities.factory("httpInterceptor",function(){return{}}),utilities.service("templateSvc",["$templateCache","userProfileSvc",function(e,t){var o=/data-(keep|omit)/;return{processTemplate:function(r){var n=r.data,i=$("<div>").append(n);return o.test(n)&&i.find('[data-omit="'+t.role+'"]').each(function(){var e=$(this);e.remove()}),n=i.html(),e.put(r.config.url,n),n}}}]),utilities.directive("cstModal",function(){return{required:"ngModel",restrict:"A",link:function(e,t,o,r){t.on("click",function(e){var t="#"+o.cstModal;$(t).modal("show")})}}}),app.directive("cstTopMenu",function(){return{restrict:"E",replace:!0,templateUrl:"/Scripts/app/partials/TopMenu.html",link:function(e,t,o){var r=t.find("a");r.on("click",function(){r.removeClass("active"),$(this).addClass("active")}),e.$on("logOff",function(){e.isAuthenticated=!1}),e.$on("logOn",function(){e.isAuthenticated=!0})}}}),app.service("activitySvc",["$resource","serviceHelperSvc",function(e,t){var o=t.ResourceActivity,r=function(e){return o.save({resourceId:e.ResourceId},e).$promise},n=function(e){return o["delete"]({resourceId:e.ResourceId,activityId:e.Id}).$promise},i=function(e){return o.query({resourceId:e})};return{addActivity:r,deleteActivity:n,getActivites:i}}]),app.factory("locationSvc",["$resource","serviceHelperSvc",function(e,t){var o=t.Location,r=function(e){return o.save(e)},n=function(e){var t=o.update(e);return t},i=function(e){return o.get({locationId:e})},c=function(){return o.query()},s=function(e){return o["delete"]({locationId:e})};return{addLocation:r,editLocation:n,getLocation:i,getLocations:c,deleteLocation:s}}]),app.factory("photoSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,t,o,r){var n=r.Photo,i=function(){return n.query({count:5})},c=function(){return n.query()},s=function(e){return n["delete"]({resourceId:e})},a=function(e){return n.save(e)},u=function(e){return n.update(e)},l=function(e){return n.get({photoId:e})},p=function(e){var r=t.all([this.getPhoto(e).$promise,o.getLocations().$promise]);return r};return{getTopPhotos:i,getPhotos:c,deletePhoto:s,addPhoto:a,editPhoto:u,getPhoto:l,createPhotoEditFormModel:p,getPagedPhoto:getPagedPhoto}}]),app.factory("resourceSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,t,o,r){var n=r.Resource,i=function(){return n.query({count:5})},c=function(){return n.query()},s=function(e){return n["delete"]({resourceId:e})},a=function(e){return n.save(e)},u=function(e){return n.update(e)},l=function(e){return n.get({resourceId:e})},p=function(e){var r=t.all([this.getResource(e).$promise,o.getLocations().$promise]);return r},d=function(e){return n.getPagedItems(e)};return{getTopFiveResources:i,getResources:c,deleteResource:s,addResource:a,editResource:u,getResource:l,createResourceEditFormModel:p,getPagedResources:d}}]),app.factory("resourceMngrSvc",["$http","serviceHelperSvc","userProfileSvc",function(e,t,o){var r=t.AuthorizationToken,n=t.Account,i=function(e){var t="";for(var o in e)e.hasOwnProperty(o)&&(t+=o+"="+e[o]+"&");return t.slice(0,t.length-1)};return{login:function(t){var n={username:t.Email,password:t.Password,grant_type:"password"};return r.requestToken(i(n),function(t){e.defaults.headers.common.Authorization="Bearer "+t.access_token,o.role=t.role})},registerUser:function(e){var t=n.register(e);return t},logOffUser:function(){e.defaults.headers.common.Authorization=null}}}]),app.factory("serviceHelperSvc",["$http","$resource",function(e,t){var o=config.apiurl,r=function(e){return o+e};return{AuthorizationToken:t(r("Token"),null,{requestToken:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),Account:t(r("api/Account/"),null,{register:{method:"post"},logOff:{method:"put"}}),Photo:t(r("api/Photos/:photoId"),{photoId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:r("api/Photos?count=:count&page=:page"),method:"GET",params:{count:"@count",page:"@page"}}}),Resource:t(r("api/Resources/:resourceId"),{resourceId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:r("api/Resources?count=:count&page=:page&sortField=:sortField&sortOrder=:sortOrder"),method:"GET",params:{count:"@count",page:"@page",sortField:"@sortField",sortOrder:"@sortOrder"}}}),Location:t(r("api/Locations/:locationId"),{locationId:"@Id"},{update:{method:"PUT"}}),ResourceActivity:t(r("api/Resources/:resourceId/Activities/:activityId"),{resourceId:"@ResourceId",activityId:"@Id"})}}]),app.factory("authorizationInterceptor",["$rootScope","$q","$location",function(e,t,o){return{responseError:function(r){switch(r.status){case 401:e.$broadcast("logOff"),o.url("/Login");break;case 403:o.url("/Login")}return t.reject(r)}}}]),app.controller("ActivitiesCtrl",["$scope","$location","activitySvc",function(e,t,o){e.deleteActivity=function(t){o.deleteActivity(t).then(function(r){e.activities=o.getActivites(t.ResourceId)})}}]),app.controller("ActivityAddCtrl",["$scope","$location","$routeParams","activitySvc",function(e,t,o,r){e.activity={ResourceId:o.resourceId},e.addActivity=function(e,o){r.addActivity(e).then(function(e){t.url("/Resources/"+e.ResourceId)})}}]),app.controller("HomeCtrl",["$scope","resourceSvc",function(e,t){function o(){r()}function r(){e.resources=t.getTopFiveResources()}o()}]),app.controller("LocationCtrl",["$scope","$location","$routeParams","locationSvc",function(e,t,o,r){function n(){o.locationId>0&&(e.location=r.getLocation(o.locationId))}e.addLocation=function(e){r.addLocation(e).$promise.then(function(e){t.url("/Locations")})},e.editLocation=function(e){r.editLocation(e).$promise.then(function(e){t.url("/Locations")})},n()}]),app.controller("LocationsCtrl",["$scope","ngTableParams","locationSvc",function(e,t,o){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e,t){o.getLocations().$promise.then(function(t){e.resolve(t)})}}),e.deleteLocation=function(t){o.deleteLocation(t).$promise.then(function(t,o){e.tableParams.reload()})}}]),app.controller("PhotoCtrl",["$scope","$routeParams","$location","photoSvc",function(e,t,o,r){function n(){t.photoId>0?e.photo=r.getPhoto(t.photoId):e.locations=locationSvc.getLocations()}e.photo={},e.addPhoto=function(e){r.addPhoto(e).$promise.then(function(e){o.url("/Photos")})},n()}]),app.controller("PhotosCtrl",["$scope","photosSvc","ngTableParams",function(e,t,o){var r=function(e){var t,o,r=e.sorting();if(r)for(var n in r){t=n,o=r[n];break}return{page:e.page(),count:e.count()}};e.tableParams=new o({page:1,count:10},{counts:[],total:0,getData:function(e,o){t.getPagedPhoto(r(o)).$promise.then(function(t){o.total(t.TotalCount),e.resolve(t.Data)})["catch"](function(e){console.log(e)})}}),e.deletePhoto=function(o){t.deletePhoto(o).$promise.then(function(t){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]),app.controller("ResourceCtrl",["$scope","$routeParams","$location","resourceSvc","locationSvc",function(e,t,o,r,n){function i(){t.resourceId>0?e.resource=r.getResource(t.resourceId):e.locations=n.getLocations()}e.resource={hasActivites:!1},e.addResource=function(e){r.addResource(e).$promise.then(function(e){o.url("/Resources")})},i()}]),app.controller("ResourceEditCtrl",["$scope","$location","$routeParams","resourceSvc",function(e,t,o,r){function n(){for(var e=[],t=1;10>=t;t++)e.push({priority:t});return e}function i(){r.createResourceEditFormModel(o.resourceId).then(function(t){e.resource=t[0],e.locations=t[1],e.priorities=n()})}i(),e.editResource=function(e){r.editResource(e).$promise.then(function(e){t.url("/Resources")})}}]),app.controller("ResourcesCtrl",["$scope","resourceSvc","ngTableParams",function(e,t,o){var r=function(e){var t,o,r=e.sorting();if(r)for(var n in r){t=n,o=r[n];break}return{page:e.page(),count:e.count(),sortField:t,sortOrder:o}};e.tableParams=new o({page:1,count:10,sorting:{Name:"asc"}},{counts:[],total:0,getData:function(e,o){t.getPagedResources(r(o)).$promise.then(function(t){o.total(t.TotalCount),e.resolve(t.Data)})["catch"](function(e){console.log(e)})}}),e.deleteResource=function(o){t.deleteResource(o).$promise.then(function(t){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]),app.controller("ResourceMngrCtrl",["$scope","$location","resourceMngrSvc",function(e,t,o){e.login=function(r){e.errorMessage="",o.login(r).$promise.then(function(o){e.$emit("logOn"),t.url("/Home")})["catch"](function(t){404==t.status&&(e.errorMessage=t.data),400===t.status?e.errorMessage="Invalid Email/Password":e.errorMessage="An error occured while performing this action. Please try after some time."})},e.register=function(r){return r.password!==r.confirmPassword?void(e.errorMessage="Passwords do not match"):(e.errorMessage="",void o.registerUser(r).$promise.then(function(n){return o.login({Email:r.email,Password:r.password}).$promise.then(function(o){e.$emit("logOn"),t.url("/Home")})})["catch"](function(t){400===t.status?e.errorMessage="Email already exists.":e.errorMessage="An error occured while performing this action. Please try after some time."}))},e.logOff=function(){o.logOffUser(),e.$emit("logOff"),t.url("/Login")}}]),app.directive("resourceActivityList",function(){return{restrict:"E",templateUrl:"/Scripts/app/directives/activities/ResourceActivityList.html",scope:{activities:"=activities"}}}),utilities.directive("cstConfirmModal",[function(){return{restrict:"A",scope:{approve:"&onApprove",deny:"&onDeny",closable:"=closable",id:"@modalId",title:"@title",message:"@message"},templateUrl:"/Scripts/app/partials/confirm-modal.html",link:function(e,t,o,r){e.closeModal=function(){angular.element("#"+e.id).modal("hide")},t.on("click",function(t){angular.element("#"+e.id).modal("show")})}}}]),utilities.directive("cstDatepicker",function(){return{restrict:"A",require:"ngModel",replace:!0,link:function(e,t,o,r){t.datepicker({maxDate:0,onSelect:function(t){r.$setViewValue(t),e.$apply(),r.$setValidity("invalid",!1)}}),t.on("keypress",function(e){return!1})}}}),utilities.directive("cstExternalUrl",function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return{link:function(o,r,n){var i=n.cstExternalUrl;i&&t.test(i)&&(o.isWebUrl=!0,r.css("text-decoration","underline"),r.css("cursor","pointer")),r.on("click",function(){o.isWebUrl&&e.open(i)})}}}),app.directive("cstDelete",function(){return{replace:!0,link:function(e,t,o,r){console.log(t),t.on("click",function(e){return confirm("Delete item?")})}}}),utilities.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor","templateSvc",function(e,t,o,r){function n(e){e.removeClass("hide"),e.addClass("show")}function i(e){e.removeClass("show"),e.addClass("hide")}var c=/\.html$|\.html\?/i,s={};return{restrict:"E",templateUrl:"/Scripts/app/partials/Loader.html",link:function(a,u,l){var p=[];o.request=function(e){return console.log("request: "+e.url),p.push({}),1==p.length&&n(u),e||t.when(e)},o.response=function(o){return c.test(o.config.url)&&(s[o.config.url]||(o.data=r.processTemplate(o),s[o.config.url]=!0)),console.log("response: "+o.config.url),p.pop(),0===p.length&&e(function(){0===p.length&&i(u)},500),o||t.when(o)},o.responseError=function(o){return p.pop(),0===p.length&&e(function(){0===p.length&&i(u)},500),t.reject(o)}}}}]),utilities.factory("httpInterceptor",function(){return{}}),utilities.service("templateSvc",["$templateCache","userProfileSvc",function(e,t){var o=/data-(keep|omit)/;return{processTemplate:function(r){var n=r.data,i=$("<div>").append(n);return o.test(n)&&i.find('[data-omit="'+t.role+'"]').each(function(){var e=$(this);e.remove()}),n=i.html(),e.put(r.config.url,n),n}}}]),utilities.directive("cstModal",function(){return{required:"ngModel",restrict:"A",link:function(e,t,o,r){t.on("click",function(e){var t="#"+o.cstModal;$(t).modal("show")})}}}),app.directive("cstTopMenu",function(){return{restrict:"E",replace:!0,templateUrl:"/Scripts/app/partials/TopMenu.html",link:function(e,t,o){var r=t.find("a");r.on("click",function(){r.removeClass("active"),$(this).addClass("active")}),e.$on("logOff",function(){e.isAuthenticated=!1}),e.$on("logOn",function(){e.isAuthenticated=!0})}}}),app.service("activitySvc",["$resource","serviceHelperSvc",function(e,t){var o=t.ResourceActivity,r=function(e){return o.save({resourceId:e.ResourceId},e).$promise},n=function(e){return o["delete"]({resourceId:e.ResourceId,activityId:e.Id}).$promise},i=function(e){return o.query({resourceId:e})};return{addActivity:r,deleteActivity:n,getActivites:i}}]),app.factory("locationSvc",["$resource","serviceHelperSvc",function(e,t){var o=t.Location,r=function(e){return o.save(e)},n=function(e){var t=o.update(e);return t},i=function(e){return o.get({locationId:e})},c=function(){return o.query()},s=function(e){return o["delete"]({locationId:e})};return{addLocation:r,editLocation:n,getLocation:i,getLocations:c,deleteLocation:s}}]),app.factory("photoSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,t,o,r){var n=r.Photo,i=function(){return n.query({count:5})},c=function(){return n.query()},s=function(e){return n["delete"]({resourceId:e})},a=function(e){return n.save(e)},u=function(e){return n.update(e)},l=function(e){return n.get({photoId:e})},p=function(e){var r=t.all([this.getPhoto(e).$promise,o.getLocations().$promise]);return r};return{getTopPhotos:i,getPhotos:c,deletePhoto:s,addPhoto:a,editPhoto:u,getPhoto:l,createPhotoEditFormModel:p,getPagedPhoto:getPagedPhoto}}]),app.factory("resourceSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,t,o,r){var n=r.Resource,i=function(){return n.query({count:5})},c=function(){return n.query()},s=function(e){return n["delete"]({resourceId:e})},a=function(e){return n.save(e)},u=function(e){return n.update(e)},l=function(e){return n.get({resourceId:e})},p=function(e){var r=t.all([this.getResource(e).$promise,o.getLocations().$promise]);return r},d=function(e){return n.getPagedItems(e)};return{getTopFiveResources:i,getResources:c,deleteResource:s,addResource:a,editResource:u,getResource:l,createResourceEditFormModel:p,getPagedResources:d}}]),app.factory("resourceMngrSvc",["$http","serviceHelperSvc","userProfileSvc",function(e,t,o){var r=t.AuthorizationToken,n=t.Account,i=function(e){var t="";for(var o in e)e.hasOwnProperty(o)&&(t+=o+"="+e[o]+"&");return t.slice(0,t.length-1)};return{login:function(t){var n={username:t.Email,password:t.Password,grant_type:"password"};return r.requestToken(i(n),function(t){e.defaults.headers.common.Authorization="Bearer "+t.access_token,o.role=t.role})},registerUser:function(e){var t=n.register(e);return t},logOffUser:function(){e.defaults.headers.common.Authorization=null}}}]),app.factory("serviceHelperSvc",["$http","$resource",function(e,t){var o=config.apiurl,r=function(e){return o+e};return{AuthorizationToken:t(r("Token"),null,{requestToken:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),Account:t(r("api/Account/"),null,{register:{method:"post"},logOff:{method:"put"}}),Photo:t(r("api/Photos/:photoId"),{photoId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:r("api/Photos?count=:count&page=:page"),method:"GET",params:{count:"@count",page:"@page"}}}),Resource:t(r("api/Resources/:resourceId"),{resourceId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:r("api/Resources?count=:count&page=:page&sortField=:sortField&sortOrder=:sortOrder"),method:"GET",params:{count:"@count",page:"@page",sortField:"@sortField",sortOrder:"@sortOrder"}}}),Location:t(r("api/Locations/:locationId"),{locationId:"@Id"},{update:{method:"PUT"}}),ResourceActivity:t(r("api/Resources/:resourceId/Activities/:activityId"),{resourceId:"@ResourceId",activityId:"@Id"})}}]);
app.factory("authorizationInterceptor",["$rootScope","$q","$location",function(r,o,t){return{responseError:function(e){switch(e.status){case 401:r.$broadcast("logOff"),t.url("/Login");break;case 403:t.url("/Login")}return o.reject(e)}}}]);
app.controller("ActivitiesCtrl",["$scope","$location","activitySvc",function(t,i,e){t.deleteActivity=function(i){e.deleteActivity(i).then(function(c){t.activities=e.getActivites(i.ResourceId)})}}]);
app.controller("ActivityAddCtrl",["$scope","$location","$routeParams","activitySvc",function(t,c,i,o){t.activity={ResourceId:i.resourceId},t.addActivity=function(t,i){o.addActivity(t).then(function(t){c.url("/Resources/"+t.ResourceId)})}}]);
app.controller("HomeCtrl",["$scope","resourceSvc",function(e,o){function c(){r()}function r(){e.resources=o.getTopFiveResources()}c()}]);
app.controller("LocationCtrl",["$scope","$location","$routeParams","locationSvc",function(o,n,t,i){function c(){t.locationId>0&&(o.location=i.getLocation(t.locationId))}o.addLocation=function(o){i.addLocation(o).$promise.then(function(o){n.url("/Locations")})},o.editLocation=function(o){i.editLocation(o).$promise.then(function(o){n.url("/Locations")})},c()}]);
app.controller("LocationsCtrl",["$scope","ngTableParams","locationSvc",function(o,t,e){o.tableParams=new t({total:1,page:1},{counts:[],getData:function(o,t){e.getLocations().$promise.then(function(t){o.resolve(t)})}}),o.deleteLocation=function(t){e.deleteLocation(t).$promise.then(function(t,e){o.tableParams.reload()})}}]);
app.controller("PhotoCtrl",["$scope","$routeParams","$location","photoSvc",function(o,t,n,c){function h(){t.photoId>0?o.photo=c.getPhoto(t.photoId):o.locations=locationSvc.getLocations()}o.photo={},o.addPhoto=function(o){c.addPhoto(o).$promise.then(function(o){n.url("/Photos")})},h()}]);
"use strict";app.controller("PhotosCtrl",["$scope","photosSvc","ngTableParams",function(t,a,o){var e=function(t){var a,o,e=t.sorting();if(e)for(var n in e){a=n,o=e[n];break}return{page:t.page(),count:t.count()}};t.tableParams=new o({page:1,count:10},{counts:[],total:0,getData:function(t,o){a.getPagedPhoto(e(o)).$promise.then(function(a){o.total(a.TotalCount),t.resolve(a.Data)})["catch"](function(t){console.log(t)})}}),t.deletePhoto=function(o){a.deletePhoto(o).$promise.then(function(a){1!==t.tableParams.page()&&1===t.tableParams.data.length&&t.tableParams.page(1),t.tableParams.reload()})}}]);
app.controller("ResourceCtrl",["$scope","$routeParams","$location","resourceSvc","locationSvc",function(e,o,c,r,s){function t(){o.resourceId>0?e.resource=r.getResource(o.resourceId):e.locations=s.getLocations()}e.resource={hasActivites:!1},e.addResource=function(e){r.addResource(e).$promise.then(function(e){c.url("/Resources")})},t()}]);
app.controller("ResourceEditCtrl",["$scope","$location","$routeParams","resourceSvc",function(e,o,r,t){function c(){for(var e=[],o=1;10>=o;o++)e.push({priority:o});return e}function i(){t.createResourceEditFormModel(r.resourceId).then(function(o){e.resource=o[0],e.locations=o[1],e.priorities=c()})}i(),e.editResource=function(e){t.editResource(e).$promise.then(function(e){o.url("/Resources")})}}]);
"use strict";app.controller("ResourcesCtrl",["$scope","resourceSvc","ngTableParams",function(e,a,t){var o=function(e){var a,t,o=e.sorting();if(o)for(var r in o){a=r,t=o[r];break}return{page:e.page(),count:e.count(),sortField:a,sortOrder:t}};e.tableParams=new t({page:1,count:10,sorting:{Name:"asc"}},{counts:[],total:0,getData:function(e,t){a.getPagedResources(o(t)).$promise.then(function(a){t.total(a.TotalCount),e.resolve(a.Data)})["catch"](function(e){console.log(e)})}}),e.deleteResource=function(t){a.deleteResource(t).$promise.then(function(a){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]);
app.controller("ResourceMngrCtrl",["$scope","$location","resourceMngrSvc",function(r,e,o){r.login=function(s){r.errorMessage="",o.login(s).$promise.then(function(o){r.$emit("logOn"),e.url("/Home")})["catch"](function(e){404==e.status&&(r.errorMessage=e.data),400===e.status?r.errorMessage="Invalid Email/Password":r.errorMessage="An error occured while performing this action. Please try after some time."})},r.register=function(s){return s.password!==s.confirmPassword?void(r.errorMessage="Passwords do not match"):(r.errorMessage="",void o.registerUser(s).$promise.then(function(t){return o.login({Email:s.email,Password:s.password}).$promise.then(function(o){r.$emit("logOn"),e.url("/Home")})})["catch"](function(e){400===e.status?r.errorMessage="Email already exists.":r.errorMessage="An error occured while performing this action. Please try after some time."}))},r.logOff=function(){o.logOffUser(),r.$emit("logOff"),e.url("/Login")}}]);
app.directive("resourceActivityList",function(){return{restrict:"E",templateUrl:"/Scripts/app/directives/activities/ResourceActivityList.html",scope:{activities:"=activities"}}});
"use strict";utilities.directive("cstConfirmModal",[function(){return{restrict:"A",scope:{approve:"&onApprove",deny:"&onDeny",closable:"=closable",id:"@modalId",title:"@title",message:"@message"},templateUrl:"/Scripts/app/partials/confirm-modal.html",link:function(e,l,t,i){e.closeModal=function(){angular.element("#"+e.id).modal("hide")},l.on("click",function(l){angular.element("#"+e.id).modal("show")})}}}]);
utilities.directive("cstDatepicker",function(){return{restrict:"A",require:"ngModel",replace:!0,link:function(e,i,t,n){i.datepicker({maxDate:0,onSelect:function(i){n.$setViewValue(i),e.$apply(),n.$setValidity("invalid",!1)}});i.on("keypress",function(e){return!1})}}});
"use strict";utilities.directive("cstExternalUrl",function(t){var r=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return{link:function(e,i,n){var s=n.cstExternalUrl;s&&r.test(s)&&(e.isWebUrl=!0,i.css("text-decoration","underline"),i.css("cursor","pointer")),i.on("click",function(){e.isWebUrl&&t.open(s)})}}});
app.directive("cstDelete",function(){return{replace:!0,link:function(e,n,c,t){console.log(n),n.on("click",function(e){return confirm("Delete item?")})}}});
"use strict";utilities.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor","templateSvc",function(t,e,r,n){function o(t){t.removeClass("hide"),t.addClass("show")}function i(t){t.removeClass("show"),t.addClass("hide")}var s=/\.html$|\.html\?/i,l={};return{restrict:"E",templateUrl:"/Scripts/app/partials/Loader.html",link:function(c,u,a){var p=[];r.request=function(t){return console.log("request: "+t.url),p.push({}),1==p.length&&o(u),t||e.when(t)},r.response=function(r){return s.test(r.config.url)&&(l[r.config.url]||(r.data=n.processTemplate(r),l[r.config.url]=!0)),console.log("response: "+r.config.url),p.pop(),0===p.length&&t(function(){0===p.length&&i(u)},500),r||e.when(r)},r.responseError=function(r){return p.pop(),0===p.length&&t(function(){0===p.length&&i(u)},500),e.reject(r)}}}}]),utilities.factory("httpInterceptor",function(){return{}}),utilities.service("templateSvc",["$templateCache","userProfileSvc",function(t,e){var r=/data-(keep|omit)/;return{processTemplate:function(n){var o=n.data,i=$("<div>").append(o);return r.test(o)&&i.find('[data-omit="'+e.role+'"]').each(function(){var t=$(this);t.remove()}),o=i.html(),t.put(n.config.url,o),o}}}]);
utilities.directive("cstModal",function(){return{required:"ngModel",restrict:"A",link:function(i,t,n,c){t.on("click",function(i){var t="#"+n.cstModal;$(t).modal("show")})}}});
app.directive("cstTopMenu",function(){return{restrict:"E",replace:!0,templateUrl:"/Scripts/app/partials/TopMenu.html",link:function(t,n,i){var e=n.find("a");e.on("click",function(){e.removeClass("active"),$(this).addClass("active")}),t.$on("logOff",function(){t.isAuthenticated=!1}),t.$on("logOn",function(){t.isAuthenticated=!0})}}});
app.service("activitySvc",["$resource","serviceHelperSvc",function(e,r){var t=r.ResourceActivity,c=function(e){return t.save({resourceId:e.ResourceId},e).$promise},i=function(e){return t["delete"]({resourceId:e.ResourceId,activityId:e.Id}).$promise},u=function(e){return t.query({resourceId:e})};return{addActivity:c,deleteActivity:i,getActivites:u}}]);
app.factory("locationSvc",["$resource","serviceHelperSvc",function(t,n){var o=n.Location,e=function(t){return o.save(t)},c=function(t){var n=o.update(t);return n},r=function(t){return o.get({locationId:t})},i=function(){return o.query()},a=function(t){return o["delete"]({locationId:t})};return{addLocation:e,editLocation:c,getLocation:r,getLocations:i,deleteLocation:a}}]);
app.factory("photoSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(t,o,e,r){var n=r.Photo,u=function(){return n.query({count:5})},c=function(){return n.query()},i=function(t){return n["delete"]({resourceId:t})},h=function(t){return n.save(t)},a=function(t){return n.update(t)},P=function(t){return n.get({photoId:t})},d=function(t){var r=o.all([this.getPhoto(t).$promise,e.getLocations().$promise]);return r};return{getTopPhotos:u,getPhotos:c,deletePhoto:i,addPhoto:h,editPhoto:a,getPhoto:P,createPhotoEditFormModel:d,getPagedPhoto:getPagedPhoto}}]);
app.factory("resourceSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,r,t,u){var o=u.Resource,c=function(){return o.query({count:5})},n=function(){return o.query()},s=function(e){return o["delete"]({resourceId:e})},i=function(e){return o.save(e)},a=function(e){return o.update(e)},d=function(e){return o.get({resourceId:e})},f=function(e){var u=r.all([this.getResource(e).$promise,t.getLocations().$promise]);return u},g=function(e){return o.getPagedItems(e)};return{getTopFiveResources:c,getResources:n,deleteResource:s,addResource:i,editResource:a,getResource:d,createResourceEditFormModel:f,getPagedResources:g}}]);
app.factory("resourceMngrSvc",["$http","serviceHelperSvc","userProfileSvc",function(r,e,n){var o=e.AuthorizationToken,t=e.Account,a=function(r){var e="";for(var n in r)r.hasOwnProperty(n)&&(e+=n+"="+r[n]+"&");return e.slice(0,e.length-1)};return{login:function(e){var t={username:e.Email,password:e.Password,grant_type:"password"};return o.requestToken(a(t),function(e){r.defaults.headers.common.Authorization="Bearer "+e.access_token,n.role=e.role})},registerUser:function(r){var e=t.register(r);return e},logOffUser:function(){r.defaults.headers.common.Authorization=null}}}]);
app.factory("serviceHelperSvc",["$http","$resource",function(e,o){var t=config.apiurl,r=function(e){return t+e};return{AuthorizationToken:o(r("Token"),null,{requestToken:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),Account:o(r("api/Account/"),null,{register:{method:"post"},logOff:{method:"put"}}),Photo:o(r("api/Photos/:photoId"),{photoId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:r("api/Photos?count=:count&page=:page"),method:"GET",params:{count:"@count",page:"@page"}}}),Resource:o(r("api/Resources/:resourceId"),{resourceId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:r("api/Resources?count=:count&page=:page&sortField=:sortField&sortOrder=:sortOrder"),method:"GET",params:{count:"@count",page:"@page",sortField:"@sortField",sortOrder:"@sortOrder"}}}),Location:o(r("api/Locations/:locationId"),{locationId:"@Id"},{update:{method:"PUT"}}),ResourceActivity:o(r("api/Resources/:resourceId/Activities/:activityId"),{resourceId:"@ResourceId",activityId:"@Id"})}}]);